<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>snazy - a convenient log viewer | Chmouel's blog</title><meta name=keywords content><meta name=description content="I have been meaning to write an article about tools that I have developed lately to make it easier for my day to day life work.
Being a so called &ldquo;Kubernetes cloud native developer&rdquo; (don&rsquo;t laugh at the title because I do) I have to watch a log of controller logs. Most controller logs output in JSON format which is a nice tool for computers but not straightforward to parse to the eyes of the mere mortals."><meta name=author content><link rel=canonical href=https://blog.chmouel.com/posts/snazy-log-viewer/><link crossorigin=anonymous href=/assets/css/stylesheet.6f7f13d3d67cfd883158e82d8eac85f5aed561afc99d35624ebeb913747e0ec5.css integrity="sha256-b38T09Z8/YgxWOgtjqyF9a7VYa/JnTViTr65E3R+DsU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.chmouel.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chmouel.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.chmouel.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.chmouel.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.chmouel.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="snazy - a convenient log viewer"><meta property="og:description" content="I have been meaning to write an article about tools that I have developed lately to make it easier for my day to day life work.
Being a so called &ldquo;Kubernetes cloud native developer&rdquo; (don&rsquo;t laugh at the title because I do) I have to watch a log of controller logs. Most controller logs output in JSON format which is a nice tool for computers but not straightforward to parse to the eyes of the mere mortals."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chmouel.com/posts/snazy-log-viewer/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-05T09:00:56+02:00"><meta property="article:modified_time" content="2022-11-05T09:00:56+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="snazy - a convenient log viewer"><meta name=twitter:description content="I have been meaning to write an article about tools that I have developed lately to make it easier for my day to day life work.
Being a so called &ldquo;Kubernetes cloud native developer&rdquo; (don&rsquo;t laugh at the title because I do) I have to watch a log of controller logs. Most controller logs output in JSON format which is a nice tool for computers but not straightforward to parse to the eyes of the mere mortals."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chmouel.com/posts/"},{"@type":"ListItem","position":2,"name":"snazy - a convenient log viewer","item":"https://blog.chmouel.com/posts/snazy-log-viewer/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"snazy - a convenient log viewer","name":"snazy - a convenient log viewer","description":"I have been meaning to write an article about tools that I have developed lately to make it easier for my day to day life work.\nBeing a so called \u0026ldquo;Kubernetes cloud native developer\u0026rdquo; (don\u0026rsquo;t laugh at the title because I do) I have to watch a log of controller logs. Most controller logs output in JSON format which is a nice tool for computers but not straightforward to parse to the eyes of the mere mortals.","keywords":[],"articleBody":"I have been meaning to write an article about tools that I have developed lately to make it easier for my day to day life work.\nBeing a so called “Kubernetes cloud native developer” (don’t laugh at the title because I do) I have to watch a log of controller logs. Most controller logs output in JSON format which is a nice tool for computers but not straightforward to parse to the eyes of the mere mortals.\nAs I was getting more annoyed trying to spot my errors in my controller, I wrote a python script in a haste called it sugarjazy.\nWhat it did is to make the log output from this :\nto this :\nI was happy with it and it did job (maybe a bit slow), python makes it easy to iterate, the cheer nature of the language being all dynamic and flexible in all kind of way made it easy to parse any sorts of json log. I think I spent 30 minutes to write it, 30 minutes to package it and be finished and happy with it.\nI was at the same time trying to find a pet project to learn rust and I thought it would be a good idea to rewrite it in rust.\nand boy I was in for a ride…\nI read tons and tons of materials on rust, I read the book, I read blog articles, I read stackoverflow obscure answer to anything, I abused github’s codeassist. I didn’t actually understand what I was doing but after a few days I was able to write a basic version of it in rust.\nAfter that I improved and tried to iterate and improve it, trying to figure out the best practice and the best way to do things.\nIt still IMHO pretty bad and probably yet another rewrite to make it proper Rust, but the good thing with Rust is when it compiles you are pretty confident it’s not going to crash and burn.\nThe naming of the tool is random called snazy (because I was lazy to find a better name) and it does what the python version is doing but in rust (in a much faster way) with a lot more features.\nHere is a list of them :\nWhen you use the -r flags (and you can have many of them) you tell snazy to highlight a regexp in the logs to get to highlight the words you need when it appears. It would colour the word differently for each regexp you use : You can skip some lines you don’t want to see with the -S flag.\nYou can filter the log levels you want to see with the -f flag (many -f can be specified for multiple levels)\nYou can have an action when some word appears. This is pretty useful for example to be able to get notified when something was successful or failed. For example on OSX you can do something like this :\nsnazy --action-regexp \"script(s)?\\s*.*has successfully ran\" --action-command \"osascript -e 'display notification \\\"{}\\\"'\" and whenever we’ve the regexp “script has successfully ran” in the logs, you will get a notification on your mac. (see notify-send for how to do that on Linux)\nIf you want some fancy emojis instead of just boring messages, you can use the --level-symbols flag (or set the environment variable SNAZY_LEVEL_SYMBOLS in your shell) : One other feature that’s most useful for us “cloud native developers” having to watch multiple containers at the same time is the integration with kail which let you to do that and many more. Whenever snazy detects that you are piping the output of kail it will automatically show it.\nThis will get the output from kail like this:\nto this :\nThe blue string is the namespace/pod[container] format, if that’s a bit too verbose you can use the flag --kail-prefix-format or SNAZY_KAIL_PREFIX_FORMAT to change it to something else. For example me, I am only interested with pods so I have this set :\nexport SNAZY_KAIL_PREFIX_FORMAT=\"{pod}\" and I get this :\nI probably should write about my ongoing experience learning Rust and figuring release and packaging and all that stuff but I think I will do that in another article.\nUntil then feel free to grab snazy from here: https://github.com/chmouel/snazy and happy log viewing (if that’s a thing you can be happy with :))\n","wordCount":"732","inLanguage":"en","datePublished":"2022-11-05T09:00:56+02:00","dateModified":"2022-11-05T09:00:56+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chmouel.com/posts/snazy-log-viewer/"},"publisher":{"@type":"Organization","name":"Chmouel's blog","logo":{"@type":"ImageObject","url":"https://blog.chmouel.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chmouel.com/ accesskey=h title="Chmouel's blog (Alt + H)">Chmouel's blog</a>
<span class=logo-switches></span></div><ul id=menu><li><a href=https://github.com/chmouel/ title=Github><span>Github</span></a></li><li><a href=https://photos.chmouel.com title=Photos><span>Photos</span></a></li><li><a href=https://app.strava.com/athletes/126695 title=Strava><span>Strava</span></a></li><li><a href=https://twitter.com/chmouel title=Twitter><span>Twitter</span></a></li><li><a href=https://redhat.com title=Work><span>Work</span></a></li><li><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>snazy - a convenient log viewer</h1><div class=post-meta><span title='2022-11-05 09:00:56 +0200 +0200'>November 5, 2022</span>&nbsp;|&nbsp;<a href=https://github.com/chmouel/blog/tree/main/content/posts/snazy-log-viewer/index.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=post-content><p>I have been meaning to write an article about tools that I have developed
lately to make it easier for my day to day life work.</p><p>Being a so called &ldquo;Kubernetes cloud native developer&rdquo; (don&rsquo;t laugh at the title
because I do) I have to watch a log of controller logs. Most controller logs
output in JSON format which is a nice tool for computers but not straightforward to
parse to the eyes of the mere mortals.</p><p>As I was getting more annoyed trying to spot my errors in my
controller, I wrote a python script in a haste called it <a href=https://github.com/chmouel/sugarjazy>sugarjazy</a>.</p><p>What it did is to make the log output from this :</p><p><img loading=lazy src=rawlogs.png alt="raw logs"></p><p>to this :</p><p><img loading=lazy src=sugarjazy.png alt="sugarjazy screenshot"></p><p>I was happy with it and it did job (maybe a bit slow), python makes
it easy to iterate, the cheer nature of the language being all dynamic
and flexible in all kind of way made it easy to parse any sorts of json log. I
think I spent 30 minutes to write it, 30 minutes to package it and be finished and happy with
it.</p><p>I was at the same time trying to find a pet project to learn rust and I
thought it would be a good idea to rewrite it in rust.</p><p>and boy I was in for a ride…</p><p>I read tons and tons of materials on rust, I read the book, I read blog
articles, I read stackoverflow obscure answer to anything, I abused github&rsquo;s
codeassist. I didn&rsquo;t actually understand what I was doing but after a
few days I was able to write a basic version of it in rust.</p><p>After that I improved and tried to iterate and improve it, trying to figure out
the best practice and the best way to do things.</p><p>It still IMHO pretty bad and probably yet another rewrite to make it proper
Rust, but the good thing with Rust is when it compiles you are pretty confident
it&rsquo;s not going to crash and burn.</p><p>The naming of the tool is random called
<a href=https://github.com/chmouel/snazy>snazy</a> (because I was lazy to find a better
name) and it does what the python version is doing but in rust (in a much faster
way) with a lot more features.</p><p>Here is a list of them :</p><ul><li>When you use the <code>-r</code> flags (and you can have many of them) you tell snazy to
highlight a regexp in the logs to get to highlight the words you need when it
appears. It would colour the word differently for each regexp you use :</li></ul><p><img loading=lazy src=regexp-highlight.png alt="snazy regexp highlight"></p><ul><li><p>You can skip some lines you don&rsquo;t want to see with the <code>-S</code> flag.</p></li><li><p>You can filter the log levels you want to see with the <code>-f</code> flag (many <code>-f</code> can be specified for multiple levels)</p></li><li><p>You can have an action when some word appears. This is pretty useful for example to be able to get notified when something was successful or failed. For example on OSX you can do something like this :</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>snazy --action-regexp <span style=color:#f1fa8c>&#34;script(s)?\s*.*has successfully ran&#34;</span> --action-command <span style=color:#f1fa8c>&#34;osascript -e &#39;display notification \&#34;{}\&#34;&#39;&#34;</span>
</span></span></code></pre></div><p>and whenever we&rsquo;ve the regexp &ldquo;script has successfully ran&rdquo; in the logs, you will get a notification on your mac. (see <a href=https://www.mankier.com/1/notify-send>notify-send</a> for how to do that on Linux)</p><ul><li>If you want some fancy emojis instead of just boring messages, you can use the <code>--level-symbols</code> flag (or set the environment variable <code>SNAZY_LEVEL_SYMBOLS</code> in your shell) :</li></ul><p><img loading=lazy src=log-level.png alt="snazy with emojis"></p><ul><li>One other feature that&rsquo;s most useful for us &ldquo;cloud native developers&rdquo; having
to watch multiple containers at the same time is the integration with
<a href=https://github.com/boz/kail>kail</a> which let you to do that and many more.</li></ul><p>Whenever <code>snazy</code> detects that you are piping the output of <code>kail</code> it will
automatically show it.</p><p>This will get the output from kail like this:</p><p><img loading=lazy src=kail-raw.png alt=kail></p><p>to this :</p><p><img loading=lazy src=kail-snazy.png alt=kail></p><p>The blue string is the <code>namespace/pod[container]</code> format, if that&rsquo;s a bit too verbose you can use the flag <code>--kail-prefix-format</code> or <code>SNAZY_KAIL_PREFIX_FORMAT</code> to change it to something else. For example me, I am only interested with pods so I have this set :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>SNAZY_KAIL_PREFIX_FORMAT</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;{pod}&#34;</span>
</span></span></code></pre></div><p>and I get this :</p><p><img loading=lazy src=kail-prefix-format.png alt=kail></p><p>I probably should write about my ongoing experience learning Rust and figuring
release and packaging and all that stuff but I think I will do that in another
article.</p><p>Until then feel free to grab snazy from here: <a href=https://github.com/chmouel/snazy>https://github.com/chmouel/snazy</a>
and happy log viewing (if that&rsquo;s a thing you can be happy with :))</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.chmouel.com/>Chmouel's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>