<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Navigating the pull_request_target conundrum in GitHub Actions with Pipelines as Code | Chmouel's blog</title>
<meta name=keywords content><meta name=description content="GitHub&rsquo;s pull_request_target
event presents a significant security challenge due to its access to the pull
request within the target repository&rsquo;s context. This can expose sensitive
secrets to untrusted users submitting pull requests.
For projects like Pipelines-as-Code (PAC), where interaction with multiple
upstream providers (Bitbucket, GitLab, GitHub) is essential, this risk is
amplified. Access to repository secrets is vital for E2E testing across these
platforms, yet arbitrary pull requests triggering secret-laden workflows is
unacceptable."><meta name=author content><link rel=canonical href=https://blog.chmouel.com/posts/github-workflows-pull_request_target/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://blog.chmouel.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chmouel.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.chmouel.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.chmouel.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.chmouel.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.chmouel.com/posts/github-workflows-pull_request_target/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://blog.chmouel.com/posts/github-workflows-pull_request_target/"><meta property="og:site_name" content="Chmouel's blog"><meta property="og:title" content="Navigating the pull_request_target conundrum in GitHub Actions with Pipelines as Code"><meta property="og:description" content="GitHub’s pull_request_target event presents a significant security challenge due to its access to the pull request within the target repository’s context. This can expose sensitive secrets to untrusted users submitting pull requests.
For projects like Pipelines-as-Code (PAC), where interaction with multiple upstream providers (Bitbucket, GitLab, GitHub) is essential, this risk is amplified. Access to repository secrets is vital for E2E testing across these platforms, yet arbitrary pull requests triggering secret-laden workflows is unacceptable."><meta property="og:locale" content="en-GB"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-25T00:54:49+02:00"><meta property="article:modified_time" content="2025-03-25T00:54:49+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Navigating the pull_request_target conundrum in GitHub Actions with Pipelines as Code"><meta name=twitter:description content="GitHub&rsquo;s pull_request_target
event presents a significant security challenge due to its access to the pull
request within the target repository&rsquo;s context. This can expose sensitive
secrets to untrusted users submitting pull requests.
For projects like Pipelines-as-Code (PAC), where interaction with multiple
upstream providers (Bitbucket, GitLab, GitHub) is essential, this risk is
amplified. Access to repository secrets is vital for E2E testing across these
platforms, yet arbitrary pull requests triggering secret-laden workflows is
unacceptable."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chmouel.com/posts/"},{"@type":"ListItem","position":2,"name":"Navigating the pull_request_target conundrum in GitHub Actions with Pipelines as Code","item":"https://blog.chmouel.com/posts/github-workflows-pull_request_target/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Navigating the pull_request_target conundrum in GitHub Actions with Pipelines as Code","name":"Navigating the pull_request_target conundrum in GitHub Actions with Pipelines as Code","description":"GitHub\u0026rsquo;s pull_request_target event presents a significant security challenge due to its access to the pull request within the target repository\u0026rsquo;s context. This can expose sensitive secrets to untrusted users submitting pull requests.\nFor projects like Pipelines-as-Code (PAC), where interaction with multiple upstream providers (Bitbucket, GitLab, GitHub) is essential, this risk is amplified. Access to repository secrets is vital for E2E testing across these platforms, yet arbitrary pull requests triggering secret-laden workflows is unacceptable.\n","keywords":[],"articleBody":"GitHub’s pull_request_target event presents a significant security challenge due to its access to the pull request within the target repository’s context. This can expose sensitive secrets to untrusted users submitting pull requests.\nFor projects like Pipelines-as-Code (PAC), where interaction with multiple upstream providers (Bitbucket, GitLab, GitHub) is essential, this risk is amplified. Access to repository secrets is vital for E2E testing across these platforms, yet arbitrary pull requests triggering secret-laden workflows is unacceptable.\nRestricting pull requests to originate solely from repository branches would mitigate this risk, but it would also severely limit external contributions—a trade-off we aimed to avoid.\nExploring Alternatives: GitHub Environments and Workflow Dispatch Initially, GitHub Environments were considered. Configuring workflows to run only within specific environments allows for leveraging GitHub’s built-in approval mechanism. This offers a user-friendly approval button in the UI. However, it necessitates manual approval for every workflow execution, including automated nightly runs, which becomes cumbersome.\nNext, the workflow_dispatch event was explored. This involved a PAC PipelineRun that triggers the workflow dispatch API and monitors its completion. The appeal lies in utilizing PAC’s robust permission control features. Approved users can trigger E2E tests by commenting /ok-to-test on pull requests, while non-approved users have the workflow automatically initiated.\nHowever, several challenges arose. While the GitHub Actions workflow was triggered with the correct SHA and input arguments, it failed to accurately target the specified SHA during execution. This resulted in inaccurate status updates in the UI. Additionally, reliably retrieving the run ID of a newly created workflow dispatch proved difficult.\nUltimately, this approach proved overly complex and challenging to debug, prompting a search for a simpler, more transparent solution.\nThe Solution: Automating with GitHub Labels and PAC The solution involved leveraging GitHub labels, specifically the e2e label, to trigger our E2E testing workflow. This approach offers several advantages:\nExplicit Triggering: Workflows are triggered only when the e2e label is added. Transparency: The label’s presence is clearly visible in the pull request UI. Simplicity: This method avoids the complexities of API-based triggering and run ID management. To automate the label application, we utilize a Pipelines-as-Code (PAC) PipelineRun. This PipelineRun is triggered on pull requests targeting the main branch and involving changes to specific files (e.g., Go files, workflow configurations).\napiVersion: tekton.dev/v1beta1 kind: PipelineRun metadata: name: e2e-label.yaml annotations: pipelinesascode.tekton.dev/on-event: \"pull_request\" pipelinesascode.tekton.dev/on-target-branch: \"main\" pipelinesascode.tekton.dev/on-path-change: \"[***/*.go, .github/workflows/*l]\" spec: pipelineSpec: tasks: - name: label-pr taskSpec: steps: - name: label-pr image: registry.access.redhat.com/ubi9/ubi env: - name: HUB_TOKEN valueFrom: secretKeyRef: name: \"nightly-ci-github-hub-token\" key: \"hub-token\" script: | #!/usr/bin/env python3 # ... Python script to add the 'e2e' label ... This PipelineRun runs within the context of PAC’s Access Control List (ACL) authorization, which is highly flexible. This allows us to define specific rules for when the e2e label should be applied. For example, we can restrict label application to pull requests originating from trusted users or those meeting specific criteria.\nBy configuring the GitHub workflow to trigger both when the label is added and when it already exists, we ensure that the workflow is executed for all relevant pull requests. This automation, driven by PAC’s flexible ACL, significantly streamlines the E2E testing process.\nAnother benefit of this approach is that if the automatic labeling fails to apply—such as when the Pull Request doesn’t involve any Go files but still requires testing—a GitHub repository admin can manually add the e2e label. This manual addition will trigger the workflow. Previously, the workflow would not have been triggered at all unless it specifically targeted changes in Go files.\nname: E2E Tests on: pull_request_target: types: - labeled - opened - reopened - synchronize jobs: e2e-tests: if: \u003e github.event_name == 'pull_request_target' \u0026\u0026 (github.event.label.name == 'e2e' || contains(github.event.pull_request.labels.*.name, 'e2e')) # ... rest of the workflow configuration Conclusion The pull_request_target event in GitHub Actions presents inherent security risks. By exploring alternative solutions and ultimately adopting a label-based triggering mechanism, coupled with PAC’s automated labeling and flexible authorization, a more secure, transparent, and manageable E2E testing workflow is established. This approach allows for maintaining a balance between security and the ability to accept contributions from external developers, while automating the triggering process.\nLinks Our E2E testing workflow: e2e.yaml Our Pipelines-as-Code PipelineRun that automates labeling: e2e-label.yaml Understanding pull_request vs pull_request_target GitHub Actions Documentation on pull_request_target Pipelines as Code Documentation ","wordCount":"704","inLanguage":"en","datePublished":"2025-03-25T00:54:49+02:00","dateModified":"2025-03-25T00:54:49+02:00","author":{"@type":"Person","name":"Chmouel Boudjnah"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chmouel.com/posts/github-workflows-pull_request_target/"},"publisher":{"@type":"Organization","name":"Chmouel's blog","logo":{"@type":"ImageObject","url":"https://blog.chmouel.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chmouel.com/ accesskey=h title="Chmouel's blog (Alt + H)">Chmouel's blog</a>
<span class=logo-switches><ul class=lang-switch></ul></span></div><ul id=menu><li><a href=https://photos.chmouel.com title=camera><svg viewBox="0 0 512 512"><title>Photo Website</title><path d="M149.1 64.8 138.7 96H64C28.7 96 0 124.7.0 160V416c0 35.3 28.7 64 64 64H448c35.3.0 64-28.7 64-64V160c0-35.3-28.7-64-64-64H373.3L362.9 64.8C356.4 45.2 338.1 32 317.4 32H194.6c-20.7.0-39 13.2-45.5 32.8zM256 192a96 96 0 110 192 96 96 0 110-192z"/></svg>
<span></span></a></li><li><a href=https://github.com/chmouel/ title=GitHub><svg viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
<span></span></a></li><li><a href=https://fosstodon.org/@chmouel title=Mastodon><svg viewBox="0 0 448 512"><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
<span></span></a></li><li><a href=https://redhat.com title=redhat><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" id="b6bdd2b4-52ab-488a-9a30-1e6d1d7dd2d4" data-name="Layer 1" viewBox="0 0 192.30001 146" sodipodi:docname="logo.svg" width="192.3" height="146" inkscape:version="0.92.5 (2060ec1f9f, 2020-04-08)"><sodipodi:namedview bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="1920" inkscape:window-height="1007" id="namedview13" showgrid="false" fit-margin-top="1" fit-margin-right="1" fit-margin-bottom="1" fit-margin-left="1" inkscape:zoom=".45930043" inkscape:cx="306.89999" inkscape:cy="73" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="1" inkscape:current-layer="b6bdd2b4-52ab-488a-9a30-1e6d1d7dd2d4"/><title>Red Hat</title><path class="a737459c-e8c7-4afa-8008-f6cfd15ccda2" d="m128 84c12.5.0 30.6-2.6 30.6-17.5a19.53 19.53.0 00-.3-3.4L150.9 30.7C149.2 23.6 147.7 20.3 135.2 14.1 125.5 9.1 104.4 1 98.1 1 92.2 1 90.5 8.5 83.6 8.5 76.9 8.5 72 2.9 65.7 2.9c-6 0-9.9 4.1-12.9 12.5.0.0-8.4 23.7-9.5 27.2a6.15 6.15.0 00-.2 1.9C43 53.7 79.3 83.9 128 84m32.5-11.4c1.7 8.2 1.7 9.1 1.7 10.1.0 14-15.7 21.8-36.4 21.8C79 104.5 38.1 77.1 38.1 59a18.35 18.35.0 011.5-7.3C22.8 52.5 1 55.5 1 74.7 1 106.2 75.6 145 134.6 145c45.3.0 56.7-20.5 56.7-36.7.0-12.7-11-27.1-30.8-35.7" id="path8" inkscape:connector-curvature="0"/><path d="m160.5 72.6c1.7 8.2 1.7 9.1 1.7 10.1.0 14-15.7 21.8-36.4 21.8C79 104.5 38.1 77.1 38.1 59a18.35 18.35.0 011.5-7.3l3.7-9.1a6.15 6.15.0 00-.2 1.9c0 9.2 36.3 39.4 84.9 39.4 12.5.0 30.6-2.6 30.6-17.5A19.53 19.53.0 00158.3 63z" id="path10" inkscape:connector-curvature="0"/></svg>
<span></span></a></li><li><a href=https://app.strava.com/athletes/126695 title=Strava><svg viewBox="0 0 384 512"><path d="M158.4.0 7 292h89.2l62.2-116.1L220.1 292h88.5zm150.2 292-43.9 88.2-44.6-88.2h-67.6l112.2 220 111.5-220z"/></svg>
<span></span></a></li><li><a href=https://twitter.com/chmouel title=Twitter><svg viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
<span></span></a></li><li><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Navigating the pull_request_target conundrum in GitHub Actions with Pipelines as Code</h1><div class=post-meta><span title='2025-03-25 00:54:49 +0200 +0200'>March 25, 2025</span>&nbsp;|&nbsp;<a href=https://github.com/chmouel/blog/tree/main/content/posts/github-workflows-pull_request_target/index.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#exploring-alternatives-github-environments-and-workflow-dispatch aria-label="Exploring Alternatives: GitHub Environments and Workflow Dispatch">Exploring Alternatives: GitHub Environments and Workflow Dispatch</a></li><li><a href=#the-solution-automating-with-github-labels-and-pac aria-label="The Solution: Automating with GitHub Labels and PAC">The Solution: Automating with GitHub Labels and PAC</a></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li><li><a href=#links aria-label=Links>Links</a></li></ul></div></details></div><div class=post-content><p>GitHub&rsquo;s <a href=https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull_request_target><code>pull_request_target</code></a>
event presents a significant security challenge due to its access to the pull
request within the <em>target</em> repository&rsquo;s context. This can expose sensitive
secrets to untrusted users submitting pull requests.</p><p>For projects like Pipelines-as-Code (PAC), where interaction with multiple
upstream providers (Bitbucket, GitLab, GitHub) is essential, this risk is
amplified. Access to repository secrets is vital for E2E testing across these
platforms, yet arbitrary pull requests triggering secret-laden workflows is
unacceptable.</p><p>Restricting pull requests to originate solely from repository branches would
mitigate this risk, but it would also severely limit external contributions—a
trade-off we aimed to avoid.</p><h2 id=exploring-alternatives-github-environments-and-workflow-dispatch>Exploring Alternatives: GitHub Environments and Workflow Dispatch<a hidden class=anchor aria-hidden=true href=#exploring-alternatives-github-environments-and-workflow-dispatch>#</a></h2><p>Initially, <a href=https://docs.github.com/en/actions/deployment/targeting-different-environments/using-environments-for-deployment>GitHub
Environments</a>
were considered. Configuring workflows to run only within specific environments
allows for leveraging GitHub&rsquo;s built-in approval mechanism. This offers a
user-friendly approval button in the UI. However, it necessitates manual
approval for <em>every</em> workflow execution, including automated nightly runs,
which becomes cumbersome.</p><p>Next, the
<a href=https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow_dispatch><code>workflow_dispatch</code></a>
event was explored. This involved a PAC PipelineRun that triggers the workflow
dispatch API and monitors its completion. The appeal lies in utilizing PAC&rsquo;s
robust permission control features. Approved users can trigger E2E tests by
commenting <code>/ok-to-test</code> on pull requests, while non-approved users have the
workflow automatically initiated.</p><p>However, several challenges arose. While the GitHub Actions workflow was
triggered with the correct SHA and input arguments, it failed to accurately
target the specified SHA during execution. This resulted in inaccurate status
updates in the UI. Additionally, reliably retrieving the run ID of a newly
created workflow dispatch proved difficult.</p><p>Ultimately, this approach proved overly complex and challenging to debug,
prompting a search for a simpler, more transparent solution.</p><h2 id=the-solution-automating-with-github-labels-and-pac>The Solution: Automating with GitHub Labels and PAC<a hidden class=anchor aria-hidden=true href=#the-solution-automating-with-github-labels-and-pac>#</a></h2><p>The solution involved leveraging GitHub labels, specifically the <code>e2e</code> label,
to trigger our E2E testing workflow. This approach offers several advantages:</p><ul><li><strong>Explicit Triggering:</strong> Workflows are triggered only when the <code>e2e</code> label is added.</li><li><strong>Transparency:</strong> The label&rsquo;s presence is clearly visible in the pull request UI.</li><li><strong>Simplicity:</strong> This method avoids the complexities of API-based triggering and run ID management.</li></ul><p>To automate the label application, we utilize a <a href=https://pipelinesascode.com/>Pipelines-as-Code
(PAC)</a> PipelineRun. This PipelineRun is triggered
on pull requests targeting the <code>main</code> branch and involving changes to specific
files (e.g., Go files, workflow configurations).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: tekton.dev/v1beta1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: PipelineRun
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: e2e-label.yaml
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>pipelinesascode.tekton.dev/on-event</span>: <span style=color:#f1fa8c>&#34;pull_request&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>pipelinesascode.tekton.dev/on-target-branch</span>: <span style=color:#f1fa8c>&#34;main&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>pipelinesascode.tekton.dev/on-path-change</span>: <span style=color:#f1fa8c>&#34;[***/*.go, .github/workflows/*l]&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>pipelineSpec</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>tasks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: label-pr
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>taskSpec</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ff79c6>name</span>: label-pr
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>image</span>: registry.access.redhat.com/ubi9/ubi
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>env</span>:
</span></span><span style=display:flex><span>                - <span style=color:#ff79c6>name</span>: HUB_TOKEN
</span></span><span style=display:flex><span>                  <span style=color:#ff79c6>valueFrom</span>:
</span></span><span style=display:flex><span>                    <span style=color:#ff79c6>secretKeyRef</span>:
</span></span><span style=display:flex><span>                      <span style=color:#ff79c6>name</span>: <span style=color:#f1fa8c>&#34;nightly-ci-github-hub-token&#34;</span>
</span></span><span style=display:flex><span>                      <span style=color:#ff79c6>key</span>: <span style=color:#f1fa8c>&#34;hub-token&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>script</span>: |<span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>                #!/usr/bin/env python3
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>                # ... Python script to add the &#39;e2e&#39; label ...</span>
</span></span></code></pre></div><p>This PipelineRun runs within the context of <a href=https://nightly.pipelines-as-code.pages.dev/docs/guide/running/#acl-permissions-for-triggering-pipelineruns>PAC&rsquo;s Access Control List</a>
(ACL) authorization, which is highly flexible. This allows us to define
specific rules for when the <code>e2e</code> label should be applied. For example, we can
restrict label application to pull requests originating from trusted users or
those meeting specific criteria.</p><p>By configuring the GitHub workflow to trigger both when the label is added and
when it already exists, we ensure that the workflow is executed for all
relevant pull requests. This automation, driven by PAC&rsquo;s flexible ACL,
significantly streamlines the E2E testing process.</p><p>Another benefit of this approach is that if the automatic labeling fails to apply—such as when the Pull Request doesn’t involve any Go files but still requires testing—a GitHub repository admin can manually add the <code>e2e</code> label. This manual addition will trigger the workflow. Previously, the workflow would not have been triggered at all unless it specifically targeted changes in Go files.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>name</span>: E2E Tests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>pull_request_target</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>types</span>:
</span></span><span style=display:flex><span>      - labeled
</span></span><span style=display:flex><span>      - opened
</span></span><span style=display:flex><span>      - reopened
</span></span><span style=display:flex><span>      - synchronize
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>e2e-tests</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span>: &gt;<span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      github.event_name == &#39;pull_request_target&#39; &amp;&amp; (github.event.label.name == &#39;e2e&#39; || contains(github.event.pull_request.labels.*.name, &#39;e2e&#39;))</span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4># ... rest of the workflow configuration</span>
</span></span></code></pre></div><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>The <code>pull_request_target</code> event in GitHub Actions presents inherent security
risks. By exploring alternative solutions and ultimately adopting a label-based
triggering mechanism, coupled with PAC&rsquo;s automated labeling and flexible
authorization, a more secure, transparent, and manageable E2E testing workflow
is established. This approach allows for maintaining a balance between
security and the ability to accept contributions from external developers,
while automating the triggering process.</p><h2 id=links>Links<a hidden class=anchor aria-hidden=true href=#links>#</a></h2><ul><li>Our E2E testing workflow: <a href=https://github.com/openshift-pipelines/pipelines-as-code/blob/main/.github/workflows/e2e.yaml>e2e.yaml</a></li><li>Our Pipelines-as-Code PipelineRun that automates labeling: <a href=https://github.com/openshift-pipelines/pipelines-as-code/blob/main/.tekton/e2e-label.yaml>e2e-label.yaml</a></li><li><a href=https://runs-on.com/github-actions/pull-request-vs-pull-request-target/>Understanding <code>pull_request</code> vs <code>pull_request_target</code></a></li><li><a href=https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull_request_target>GitHub Actions Documentation on <code>pull_request_target</code></a></li><li><a href=https://pipelinesascode.com/>Pipelines as Code Documentation</a></li></ul></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.chmouel.com/>Chmouel's blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>