<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Howto shutdown your Cloud Server and not getting billed for it. | Chmouel's blog</title><meta name=keywords content="Cloud,Rackspace"><meta name=description content="Currently in Rackspace-Cloud when you are shutting-down your Cloud Servers you are still paying for it.
The reason is that when the Cloud Server is shut-down your CloudServer is still sitting on the hyper-visor and still use resources on the Cloud and then get you billed for it.
There is a way to get around it by having the CloudServer stored as an image into CloudFiles.
The caveat with this solution is that every-time you are creating a server out of the stored image you are getting a new IP and in certain cases you would need to make a change in your application with the new IP."><meta name=author content><link rel=canonical href=https://blog.chmouel.com/2011/04/07/howto-shutdown-your-cloud-server-and-not-getting-billed-for-it/><link crossorigin=anonymous href=/assets/css/stylesheet.6f7f13d3d67cfd883158e82d8eac85f5aed561afc99d35624ebeb913747e0ec5.css integrity="sha256-b38T09Z8/YgxWOgtjqyF9a7VYa/JnTViTr65E3R+DsU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.chmouel.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chmouel.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.chmouel.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.chmouel.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.chmouel.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Howto shutdown your Cloud Server and not getting billed for it."><meta property="og:description" content="Currently in Rackspace-Cloud when you are shutting-down your Cloud Servers you are still paying for it.
The reason is that when the Cloud Server is shut-down your CloudServer is still sitting on the hyper-visor and still use resources on the Cloud and then get you billed for it.
There is a way to get around it by having the CloudServer stored as an image into CloudFiles.
The caveat with this solution is that every-time you are creating a server out of the stored image you are getting a new IP and in certain cases you would need to make a change in your application with the new IP."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chmouel.com/2011/04/07/howto-shutdown-your-cloud-server-and-not-getting-billed-for-it/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2011-04-07T09:36:28+00:00"><meta property="article:modified_time" content="2011-04-07T09:36:28+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Howto shutdown your Cloud Server and not getting billed for it."><meta name=twitter:description content="Currently in Rackspace-Cloud when you are shutting-down your Cloud Servers you are still paying for it.
The reason is that when the Cloud Server is shut-down your CloudServer is still sitting on the hyper-visor and still use resources on the Cloud and then get you billed for it.
There is a way to get around it by having the CloudServer stored as an image into CloudFiles.
The caveat with this solution is that every-time you are creating a server out of the stored image you are getting a new IP and in certain cases you would need to make a change in your application with the new IP."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chmouel.com/posts/"},{"@type":"ListItem","position":2,"name":"Howto shutdown your Cloud Server and not getting billed for it.","item":"https://blog.chmouel.com/2011/04/07/howto-shutdown-your-cloud-server-and-not-getting-billed-for-it/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Howto shutdown your Cloud Server and not getting billed for it.","name":"Howto shutdown your Cloud Server and not getting billed for it.","description":"Currently in Rackspace-Cloud when you are shutting-down your Cloud Servers you are still paying for it.\nThe reason is that when the Cloud Server is shut-down your CloudServer is still sitting on the hyper-visor and still use resources on the Cloud and then get you billed for it.\nThere is a way to get around it by having the CloudServer stored as an image into CloudFiles.\nThe caveat with this solution is that every-time you are creating a server out of the stored image you are getting a new IP and in certain cases you would need to make a change in your application with the new IP.","keywords":["Cloud","Rackspace"],"articleBody":"Currently in Rackspace-Cloud when you are shutting-down your Cloud Servers you are still paying for it.\nThe reason is that when the Cloud Server is shut-down your CloudServer is still sitting on the hyper-visor and still use resources on the Cloud and then get you billed for it.\nThere is a way to get around it by having the CloudServer stored as an image into CloudFiles.\nThe caveat with this solution is that every-time you are creating a server out of the stored image you are getting a new IP and in certain cases you would need to make a change in your application with the new IP.\nIf you only use domain names instead of IP in your application you are not dependent of the IP change, to update the domain with the new IP after creating the VM you can either :\nHave a dynamic DNS or ‘Cloud DNS’ updated just after you created your server out of the image.\nHave a script going into your server and update the IP directly in /etc/hosts.\nIn programming words this is the steps you would do. I am using the python-nova binding which allow you to connect to RackSpace Cloud.\nAt first I am going to create an object which we are going to authenticate\nimport novaclient cx = novaclient.OpenStack(USERNAME, API_KEY) or for the UK :\nimport novaclient cx = novaclient.OpenStack(\"USERNAME\", \"API_KEY\", 'https://lon.auth.api.rackspacecloud.com/v1.0') cx is going to be the object from where we can do things on it. Let’s first find the server server that we want, assuming your server is called test you would get the server like this :\nserver = cx.servers.find(name='test') The variable ‘server’ contain our server ‘object’ and we can get its ID out of it :\nserver_id = server.id We got the function cx.images.create to create an image from a server which accept as first argument the image name and the second the server id we just got. this would start the creation of the image :\ncx.images.create(\"backup_server\", server_id) The server has started to get backed-up into your Cloud Files account, you can see it directly into the “My Server Images” tab of Hosting =\u003e Cloud Servers section :\nYou can now delete the server since it’s ‘backuped’ into cloud files ;\nserver.delete() At this time you are not billed for your Cloud Servers anymore and only for the storage usage in Cloud Files.\nWhen you want to restore the image as a server, you would first get the id of your image :\nimage = cx.images.find(name='backup-test') image_id = image.id and create the server out of this image :\nCNX.servers.create(image=image_id, flavor=1, name=\"test\", ) The flavor argument is the type of image you want, 1 the minimal 256M flavor. The full list is :\nIn [14]: for x in cx.flavors.list(): ....: print x.id, '-', x.name ....: ....: 1 - 256 server 2 - 512 server 3 - 1GB server 4 - 2GB server 5 - 4GB server 6 - 8GB server 7 - 15.5GB server When the server has created it should be exactly the same as what you have before created in image. You can now run a script using SSH with SSH keys to log into servers and do adjustment with the new IP.\n","wordCount":"540","inLanguage":"en","datePublished":"2011-04-07T09:36:28Z","dateModified":"2011-04-07T09:36:28Z","author":{"@type":"Person","name":"chmouel"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chmouel.com/2011/04/07/howto-shutdown-your-cloud-server-and-not-getting-billed-for-it/"},"publisher":{"@type":"Organization","name":"Chmouel's blog","logo":{"@type":"ImageObject","url":"https://blog.chmouel.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chmouel.com/ accesskey=h title="Chmouel's blog (Alt + H)">Chmouel's blog</a>
<span class=logo-switches></span></div><ul id=menu><li><a href=https://github.com/chmouel/ title=Github><span>Github</span></a></li><li><a href=https://photos.chmouel.com title=Photos><span>Photos</span></a></li><li><a href=https://app.strava.com/athletes/126695 title=Strava><span>Strava</span></a></li><li><a href=https://twitter.com/chmouel title=Twitter><span>Twitter</span></a></li><li><a href=https://redhat.com title=Work><span>Work</span></a></li><li><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Howto shutdown your Cloud Server and not getting billed for it.</h1><div class=post-meta><span title='2011-04-07 09:36:28 +0000 UTC'>April 7, 2011</span>&nbsp;|&nbsp;<a href=https://github.com/chmouel/blog/tree/main/content/posts/2011-04-07-howto-shutdown-your-cloud-server-and-not-getting-billed-for-it.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=post-content><p>Currently in Rackspace-Cloud when you are shutting-down your Cloud Servers you are still paying for it.</p><p>The reason is that when the Cloud Server is shut-down your CloudServer is still sitting on the hyper-visor and still use resources on the Cloud and then get you billed for it.</p><p>There is a way to get around it by having the CloudServer stored as an image into CloudFiles.</p><p>The caveat with this solution is that every-time you are creating a server out of the stored image you are getting a new IP and in certain cases you would need to make a change in your application with the new IP.</p><p>If you only use domain names instead of IP in your application you are not dependent of the IP change, to update the domain with the new IP after creating the VM you can either :</p><ul><li><p>Have a dynamic DNS or &lsquo;Cloud DNS&rsquo; updated just after you created your server out of the image.</p></li><li><p>Have a script going into your server and update the IP directly in /etc/hosts.</p></li></ul><p>In programming words this is the steps you would do. I am using the python-nova binding which allow you to connect to RackSpace Cloud.</p><p>At first I am going to create an object which we are going to authenticate</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> novaclient
</span></span><span style=display:flex><span>cx <span style=color:#ff79c6>=</span> novaclient<span style=color:#ff79c6>.</span>OpenStack(USERNAME,
</span></span><span style=display:flex><span>                            API_KEY)
</span></span></code></pre></div><p>or for the UK :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> novaclient
</span></span><span style=display:flex><span>cx <span style=color:#ff79c6>=</span> novaclient<span style=color:#ff79c6>.</span>OpenStack(<span style=color:#f1fa8c>&#34;USERNAME&#34;</span>,
</span></span><span style=display:flex><span>                            <span style=color:#f1fa8c>&#34;API_KEY&#34;</span>,
</span></span><span style=display:flex><span>                            <span style=color:#f1fa8c>&#39;https://lon.auth.api.rackspacecloud.com/v1.0&#39;</span>)
</span></span></code></pre></div><p>cx is going to be the object from where we can do things on it. Let&rsquo;s first find the server server that we want, assuming your server is called test you would get the server like this :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span>server <span style=color:#ff79c6>=</span> cx<span style=color:#ff79c6>.</span>servers<span style=color:#ff79c6>.</span>find(name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;test&#39;</span>)
</span></span></code></pre></div><p>The variable &lsquo;server&rsquo; contain our server &lsquo;object&rsquo; and we can get its ID out of it :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span>server_id <span style=color:#ff79c6>=</span> server<span style=color:#ff79c6>.</span>id
</span></span></code></pre></div><p>We got the function cx.images.create to create an image from a server which accept as first argument the image name and the second the server id we just got. this would start the creation of the image :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span>cx<span style=color:#ff79c6>.</span>images<span style=color:#ff79c6>.</span>create(<span style=color:#f1fa8c>&#34;backup_server&#34;</span>, server_id)
</span></span></code></pre></div><p>The server has started to get backed-up into your Cloud Files account, you can see it directly into the &ldquo;My Server Images&rdquo; tab of Hosting => Cloud Servers section :</p><p><a href=/wp-content/uploads/2011/04/Backup.png></a></p><p>You can now delete the server since it&rsquo;s &lsquo;backuped&rsquo; into cloud files ;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span>server<span style=color:#ff79c6>.</span>delete()
</span></span></code></pre></div><p>At this time you are not billed for your Cloud Servers anymore and only for the storage usage in Cloud Files.</p><p>When you want to restore the image as a server, you would first get the id of your image :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span>image <span style=color:#ff79c6>=</span> cx<span style=color:#ff79c6>.</span>images<span style=color:#ff79c6>.</span>find(name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;backup-test&#39;</span>)
</span></span><span style=display:flex><span>image_id <span style=color:#ff79c6>=</span> image<span style=color:#ff79c6>.</span>id
</span></span></code></pre></div><p>and create the server out of this image :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span>CNX<span style=color:#ff79c6>.</span>servers<span style=color:#ff79c6>.</span>create(image<span style=color:#ff79c6>=</span>image_id,
</span></span><span style=display:flex><span>                            flavor<span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span>,
</span></span><span style=display:flex><span>                            name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;test&#34;</span>,
</span></span><span style=display:flex><span>                            )
</span></span></code></pre></div><p>The flavor argument is the type of image you want, 1 the minimal 256M flavor. The full list is :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span>In [<span style=color:#bd93f9>14</span>]: <span style=color:#ff79c6>for</span> x <span style=color:#ff79c6>in</span> cx<span style=color:#ff79c6>.</span>flavors<span style=color:#ff79c6>.</span>list():
</span></span><span style=display:flex><span>   <span style=color:#ff79c6>....</span>:     <span style=color:#8be9fd;font-style:italic>print</span> x<span style=color:#ff79c6>.</span>id, <span style=color:#f1fa8c>&#39;-&#39;</span>, x<span style=color:#ff79c6>.</span>name
</span></span><span style=display:flex><span>   <span style=color:#ff79c6>....</span>:     
</span></span><span style=display:flex><span>   <span style=color:#ff79c6>....</span>:     
</span></span><span style=display:flex><span><span style=color:#bd93f9>1</span> <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>256</span> server
</span></span><span style=display:flex><span><span style=color:#bd93f9>2</span> <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>512</span> server
</span></span><span style=display:flex><span><span style=color:#bd93f9>3</span> <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>1</span>GB server
</span></span><span style=display:flex><span><span style=color:#bd93f9>4</span> <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>2</span>GB server
</span></span><span style=display:flex><span><span style=color:#bd93f9>5</span> <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>4</span>GB server
</span></span><span style=display:flex><span><span style=color:#bd93f9>6</span> <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>8</span>GB server
</span></span><span style=display:flex><span><span style=color:#bd93f9>7</span> <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>15.5</span>GB server
</span></span></code></pre></div><p>When the server has created it should be exactly the same as what you have before created in image. You can now run a script using SSH with SSH keys to log into servers and do adjustment with the new IP.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.chmouel.com/tags/cloud/>Cloud</a></li><li><a href=https://blog.chmouel.com/tags/rackspace/>Rackspace</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.chmouel.com/>Chmouel's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>