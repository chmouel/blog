<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Getting a letsencrypt SSL certificate for the OpenShift console and API | Chmouel's blog</title><meta name=keywords content="OpenShift"><meta name=description content="By default when you install an OpenShift install it would automatically generate its own certificates.
It uses those certificates for communication between nodes and as well to automatically auth the admin account. By default those same certificates are the one provided for the OpenShift console and API.
Since it is auto generated you will when connecting to the website with you webbrowser get an ugly error message :
and as the error message says that&rsquo;s not very secure #sadpanda."><meta name=author content><link rel=canonical href=https://blog.chmouel.com/2016/09/29/getting-a-letsencrypt-ssl-certificate-for-the-openshift-console-and-api/><link crossorigin=anonymous href=/assets/css/stylesheet.min.9542043683b51fd916615028ef4e8b1254235082a92e7a74210837182bf752e5.css integrity="sha256-lUIENoO1H9kWYVAo706LElQjUIKpLnp0IQg3GCv3UuU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.chmouel.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chmouel.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.chmouel.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.chmouel.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.chmouel.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Getting a letsencrypt SSL certificate for the OpenShift console and API"><meta property="og:description" content="By default when you install an OpenShift install it would automatically generate its own certificates.
It uses those certificates for communication between nodes and as well to automatically auth the admin account. By default those same certificates are the one provided for the OpenShift console and API.
Since it is auto generated you will when connecting to the website with you webbrowser get an ugly error message :
and as the error message says that&rsquo;s not very secure #sadpanda."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chmouel.com/2016/09/29/getting-a-letsencrypt-ssl-certificate-for-the-openshift-console-and-api/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-09-29T08:22:48+00:00"><meta property="article:modified_time" content="2016-09-29T08:22:48+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Getting a letsencrypt SSL certificate for the OpenShift console and API"><meta name=twitter:description content="By default when you install an OpenShift install it would automatically generate its own certificates.
It uses those certificates for communication between nodes and as well to automatically auth the admin account. By default those same certificates are the one provided for the OpenShift console and API.
Since it is auto generated you will when connecting to the website with you webbrowser get an ugly error message :
and as the error message says that&rsquo;s not very secure #sadpanda."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chmouel.com/posts/"},{"@type":"ListItem","position":2,"name":"Getting a letsencrypt SSL certificate for the OpenShift console and API","item":"https://blog.chmouel.com/2016/09/29/getting-a-letsencrypt-ssl-certificate-for-the-openshift-console-and-api/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Getting a letsencrypt SSL certificate for the OpenShift console and API","name":"Getting a letsencrypt SSL certificate for the OpenShift console and API","description":"By default when you install an OpenShift install it would automatically generate its own certificates.\nIt uses those certificates for communication between nodes and as well to automatically auth the admin account. By default those same certificates are the one provided for the OpenShift console and API.\nSince it is auto generated you will when connecting to the website with you webbrowser get an ugly error message :\nand as the error message says that\u0026rsquo;s not very secure #sadpanda.","keywords":["OpenShift"],"articleBody":"By default when you install an OpenShift install it would automatically generate its own certificates.\nIt uses those certificates for communication between nodes and as well to automatically auth the admin account. By default those same certificates are the one provided for the OpenShift console and API.\nSince it is auto generated you will when connecting to the website with you webbrowser get an ugly error message :\nand as the error message says that’s not very secure #sadpanda.\nThere is an easy way to generate certificate these days and it is to use letsencrypt, so let’s see how to connect it to the openshift console.\nThere is something to understand first here, when you want to use an alternate SSL certificates for your console and API you can’t do that on your default (master) URL, it has to be another url. Phrased in another way here is a quote from the official documentation :\nwith that in mind let’s assume you have setup a domain being a CNAME to your default domain. For myself here since this is a test install I went to use the easy way and I will use the xp.io service as I have documented in an earlier post. This give me easily a domain which would look like this :\nSo now that you have defined it, you need first to generate the letsencrypt certificate usually you would use certbotfrom RHEL EPEL to generate them but unfortunately at the time of writing this blog post the package was uninstallable for me which probably would get fixed soon. In the meantime I have used letsencrypt from git directly as like this:\nbefore you do anything, you need to understand the letsencrypt process, usually you would have an apache or nginx (etc…) serving the generated files for verifications (the /.well-known/ thing) since we can’t do that for us in openshift you can use the letsencrypt builtin webserver for that.\nBut to start the builtin webserver you need to be able to do it to bind it on port 80 but for us on master there is the router running which bind to it (and 443), so you would need to make sure it’s down and the most elegant way to do that with openshift is like this :\nnow that you have nothing on port 80 you can tell letsencrypt to do its magic with this command line :\nchange the lb.198.154.189.125.xip.io here to your own domain as the email address, if everything goes well you should get something like this :\nnow you should have all the certificates needed in /etc/letsencrypt/live/${domain}\nSo there is a little caveat here, there is a bug in openshift-ansible currently with symlinks and certificates and the way it operates. I have filled the bug here and it has already been fixed in GIT so hopefully by the time you will read this article this would be fixed in the openshift-ansible rpm if it’s not you can directly use the GIT openshift-ansible instead of the package.mber (3) here is going to change so you would have to adjust.\nnow you just need to some configuration in your /etc/ansible/hosts file :\nafter you run your playbook (with ansible-playbook /usr/share/ansible/openshift-ansible/playbooks/byo/config.yml) you should have it running properly and now when accessing by the console you should the reassuring secure lock :\nNB:\n If you need to renew the certs just do the steps where you oc scale the router quickly and renew the certificate with the letsencrypt auto command line mentioned earlier. There is probably a way more elegant way to do that with a container and a route. I saw this on dockerhub but this seems to be tailored to apps (and kube) and I don’t think this could be used for the OpenShift console. Don’t forget to oc scale –replicas=1 dc/router(even tho the ansible rerun should have done for you.  ","wordCount":"648","inLanguage":"en","datePublished":"2016-09-29T08:22:48Z","dateModified":"2016-09-29T08:22:48Z","author":{"@type":"Person","name":"chmouel"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chmouel.com/2016/09/29/getting-a-letsencrypt-ssl-certificate-for-the-openshift-console-and-api/"},"publisher":{"@type":"Organization","name":"Chmouel's blog","logo":{"@type":"ImageObject","url":"https://blog.chmouel.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chmouel.com/ accesskey=h title="Chmouel's blog (Alt + H)">Chmouel's blog</a>
<span class=logo-switches></span></div><ul id=menu><li><a href=https://github.com/chmouel/ title=Github><span>Github</span></a></li><li><a href=https://photos.chmouel.com title=Photos><span>Photos</span></a></li><li><a href=https://app.strava.com/athletes/126695 title=Strava><span>Strava</span></a></li><li><a href=https://twitter.com/chmouel title=Twitter><span>Twitter</span></a></li><li><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Getting a letsencrypt SSL certificate for the OpenShift console and API</h1><div class=post-meta><span title="2016-09-29 08:22:48 +0000 UTC">September 29, 2016</span>&nbsp;|&nbsp;<a href=https://github.com/chmouel/blog/tree/main/content/posts/2016-09-29-getting-a-letsencrypt-ssl-certificate-for-the-openshift-console-and-api.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=post-content><p>By default when you install an OpenShift install it would automatically generate its own certificates.</p><p>It uses those certificates for communication between nodes and as well to automatically auth the admin account. By default those same certificates are the one provided for the OpenShift console and API.</p><p>Since it is auto generated you will when connecting  to the website with you webbrowser get an ugly error message :</p><p><img loading=lazy src=/wp-content/uploads/2016/09/2016-09-28__23-40-01-20126.png alt></p><p>and as the error message says that&rsquo;s not very secure #sadpanda.</p><p>There is an easy way to generate certificate these days and it is to use <a href=https://letsencrypt.org>letsencrypt</a>, so let&rsquo;s see how to connect it to the openshift console.</p><p>There is something to understand first here,  when you want to use an alternate SSL certificates for your console and API you can&rsquo;t do that on your default (master) URL, it has to be another url. Phrased in another way here is a quote from the <a href=https://access.redhat.com/documentation/en/openshift-enterprise/3.1/paged/installation-and-configuration/chapter-2-installing#advanced-install-custom-certificates>official documentation</a>  :</p><p><img loading=lazy src=/wp-content/uploads/2016/09/2016-09-28__23-55-03-27531.png alt></p><p>with that in mind let&rsquo;s assume you have setup a domain being a CNAME to your default domain. For myself here since this is a test install I went to use the easy way and I will use the xp.io service as <a href=https://blog.chmouel.com/2016/09/28/easily-test-your-openshift-applications-exposed-by-the-router/>I have documented in an earlier post</a>. This give me easily a domain which would look like this :</p><p>So now that you have defined it, you need first to generate the letsencrypt certificate usually you would use <a href=https://certbot.eff.org/#centosrhel7-other>certbot</a>from RHEL EPEL to generate them but unfortunately at the time of writing this blog post the package was  uninstallable for me which probably would get fixed soon. In the meantime I have used letsencrypt from git directly as like this:</p><p>before you do anything, you need to understand the letsencrypt  process, usually you would have an apache or nginx (etc&mldr;) serving the generated files for verifications  (the /.well-known/ thing) since we can&rsquo;t do that for us in openshift you can use the letsencrypt builtin webserver for that.</p><p>But to start the builtin webserver you need to be able to do it to bind it on port 80  but for us on master there is the router running which bind to it (and 443), so you would need to make sure it&rsquo;s down and the most elegant way to do that with openshift is like this :</p><p>now that you have nothing on port 80 you can tell letsencrypt to do its magic with this command line :</p><p>change the <em>lb.198.154.189.125.xip.io</em> here to your own domain as the email address, if everything goes well you should get something like this :</p><p><img loading=lazy src=/wp-content/uploads/2016/09/2016-09-29__00-08-22-10578.png alt></p><p>now you should have all the certificates needed in /etc/letsencrypt/live/${domain}</p><p>So there is a little caveat here, there is a bug in openshift-ansible currently with symlinks and certificates and the way it operates. I have filled the bug <a href=https://github.com/openshift/openshift-ansible/issues/2526>here</a> and it has already been fixed in GIT so hopefully by the time you will read this article this would be fixed in the openshift-ansible rpm if it&rsquo;s not you can directly use the GIT openshift-ansible instead of the package.mber (3) here is going to change so you would have to adjust.</p><p>now you just need to some configuration in your /etc/ansible/hosts file :</p><p>after you run your playbook (with ansible-playbook /usr/share/ansible/openshift-ansible/playbooks/byo/config.yml) you should have it running properly and now when accessing by the console you should the reassuring secure lock :</p><p><img loading=lazy src=/wp-content/uploads/2016/09/2016-09-29__10-11-32-12477.png alt></p><p><strong>NB</strong>:</p><ul><li>If you need to renew the certs just do the steps where you oc scale the router quickly and renew the certificate with the letsencrypt auto command line mentioned earlier.</li><li>There is probably a way more elegant way to do that with a container and a route. I saw <a href=https://hub.docker.com/r/sjenning/kube-nginx-letsencrypt/>this</a> on dockerhub but this seems to be tailored to apps (and kube) and I don&rsquo;t think this could be used for the OpenShift console.</li><li>Don&rsquo;t forget to <em>oc scale &ndash;replicas=1 dc/router</em>(even tho the ansible rerun should have done for you.</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.chmouel.com/tags/openshift/>OpenShift</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://blog.chmouel.com/>Chmouel's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>